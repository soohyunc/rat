#
# Makefile for the RAT project. This probably requires GNU make.
#

CFLAGS         = __WFLAGS__ __DEBUG__ __CHAR__ __PROFILE__ __OPTIMIZE__ __CHECK_FLAG__ __DEFS__ -D__OSTYPE__ -DSASR -DFAST -DUSE_FLOAT_MUL
INCLUDE        = __INCLUDE__
CC             = __CC__

AUDIO_OBJS = __AUDIO__ auddev.o auddev_null.o audio_fmt.o audio_util.o

CODEC_OBJS = codec.o codec_state.o codec_dvi.o codec_gsm.o \
             codec_l16.o codec_g711.o codec_g726.o codec_lpc.o \
             codec_types.o codec_vdvi.o codec_wbs.o cx_dvi.o \
             cx_g726.o cx_g726_24.o cx_g726_32.o cx_g726_40.o \
             cx_gsm.o cx_lpc.o cx_vdvi.o cx_wbs.o

CC_OBJS    = channel.o channel_types.o cc_vanilla.o cc_rdncy.o

TOY_OBJS   = convert.o crypt.o render_3D.o repair.o sndfile.o 

CORE_OBJS  = ts.o playout.o statistics.o source.o \
             rtcp.o rtcp_db.o rtcp_pckt.o session.o \
             mbus_engine.o audio.o cushion.o main.o \
             mbus_ui.o mix.o net.o parameters.o pckt_queue.o \
             tcltk.o timers.o transmit.o transcoder.o \
             ui.o 

OBJS = $(AUDIO_OBJS) $(CODEC_OBJS) $(CC_OBJS) $(TOY_OBJS) $(CORE_OBJS)

SRCS := $(OBJS:%.o=%.c)

TCL_OBJS = ui_audiotool.o ui_transcoder.o
TCL_SRCS := $(TCL_OBJS:%.o=%.c)

rat: $(OBJS) $(TCL_OBJS) ../common/libcommon.a 
	$(CC) $(OBJS) $(TCL_OBJS) $(CFLAGS) __LDLIBS__ __PROFILE__ __OPTIMIZE__ __CHECK_LIB__ -o rat

.c.o:
	$(CC) $(INCLUDE) $(CFLAGS) -c $<

tcl2c/tcl2c: tcl2c/tcl2c.c
	$(CC) -o tcl2c/tcl2c tcl2c/tcl2c.c

$(TCL_OBJS): $(TCL_SRCS)

ui_transcoder.c: ui_transcoder.tcl tcl2c/tcl2c
	cat ui_transcoder.tcl | tcl2c/tcl2c ui_transcoder > ui_transcoder.c

ui_audiotool.c: ui_audiotool.tcl tcl2c/tcl2c
	cat asfilebox.tcl ui_audiotool.tcl | tcl2c/tcl2c ui_audiotool > ui_audiotool.c

clean:
	-rm -f $(OBJS) tcl_libs.c ui_audiotool.c ui_transcoder.c version.h Makefile Makefile.sed tcl2c/tcl2c rat 

etags:
	etags *.[ch] ../common/*.[ch]

ctags:
	ctags *.[ch] ../common/*.[ch]

release:
	cvs tag release-`cat VERSION | sed "s/\./-/g"`

tgz: rat
	tar cvf rat-`cat VERSION`-__OSTYPE__.tar README.* MODS COPYRIGHT rat
	gzip -9v rat-`cat VERSION`-__OSTYPE__.tar

depend: $(SRCS)
	makedepend $(INCLUDE) $(SRCS)
